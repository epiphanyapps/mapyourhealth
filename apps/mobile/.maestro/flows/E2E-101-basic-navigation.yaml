# flow: E2E-101 Basic Navigation
# intent:
#   Test navigation between key screens and back navigation:
#   1. Dashboard → Search → tap suggestion → Location detail
#   2. Back navigation to dashboard
#   3. Dashboard → auth gate → Login → Signup → back
#   Verifies smooth transitions and no crashes.
#
# NOTE: Requires network access for search API.
# Issue: https://github.com/epiphanyapps/mapyourhealth/issues/100

appId: ${MAESTRO_APP_ID}
onFlowStart:
  - runFlow: ../shared/_OnFlowStart.yaml
---

# ========================================
# Part 1: Dashboard → Location via Search
# ========================================
- assertVisible:
    text: "Search city or location..."
    label: "Dashboard loaded with search bar"

- tapOn:
    text: "Search city or location..."
    label: "Tap search bar"

- inputText: "New York"

# Wait for autocomplete suggestions to appear
- waitForAnimationToEnd:
    timeout: 5000

# Tap the first suggestion that appears
- tapOn:
    text: ".*New York.*"
    index: 0
    label: "Tap first New York suggestion"

# Wait for location data to load
- waitForAnimationToEnd:
    timeout: 10000

# ========================================
# Part 2: Back Navigation to Dashboard
# ========================================
- back
- waitForAnimationToEnd:
    timeout: 3000

# Verify we're back at dashboard
- assertVisible:
    text: "Search city or location..."
    label: "Back on dashboard with search bar"

# ========================================
# Part 3: Profile / Auth Navigation
# ========================================
# Tap profile icon (top right) to trigger auth
- tapOn:
    point: "93%,6%"
    label: "Tap profile icon area"

- waitForAnimationToEnd:
    timeout: 3000

# If profile menu or login appears, verify
- runFlow:
    when:
      visible: "Sign In"
    commands:
      - assertVisible:
          text: "Sign In"
          label: "Auth screen visible"
      - back
      - waitForAnimationToEnd:
          timeout: 3000

- runFlow:
    when:
      visible: "Log In"
    commands:
      - tapOn:
          text: "Log In"
      - waitForAnimationToEnd:
          timeout: 3000
      - back
      - waitForAnimationToEnd:
          timeout: 3000
