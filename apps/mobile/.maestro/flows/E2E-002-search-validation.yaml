# flow: E2E-002 Search Validation
# intent:
#   Validate search functionality for different input types:
#   1. City search (New York) - verify data and category cards appear
#   2. Different city search (Montreal) - verify location search works
#
# This flow ensures the search feature correctly handles both
# numeric postal codes and text-based city names.

appId: ${MAESTRO_APP_ID}
onFlowStart:
  - runFlow: ../shared/_OnFlowStart.yaml
---

# ========================================
# Test 1: City Search (New York)
# ========================================
- assertVisible:
    text: "Search city or location..."
    label: "Search bar is visible"

- tapOn:
    text: "Search city or location..."
    label: "Tap on search bar"

# Enter postal code 10001
- inputText: "10001"

# Submit the search
- pressKey: Enter

- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "New York"
    timeout: 10000

# Assert the location is displayed
- assertVisible:
    text: "10001"
    label: "Location 10001 is displayed in results"

# Assert category cards appear (Water, Air, Health, or Disaster)
# Using optional: true since exact cards may vary by location
- assertVisible:
    text: "Tap Water.*"
    optional: true
    label: "Tap Water Quality category card visible"

- assertVisible:
    text: "Air Pollut.*"
    optional: true
    label: "Air Pollution category card visible"

- assertVisible:
    text: "Pathogen.*"
    optional: true
    label: "Pathogens category card visible"

- assertVisible:
    text: "Disaster.*"
    optional: true
    label: "Disaster Risk category card visible"

# ========================================
# Test 2: City Search (Montreal)
# ========================================
- tapOn:
    text: "Search city or location..."
    label: "Tap on search bar for city search"

- inputText: "Montreal"
- pressKey: Enter

- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "Montreal"
    timeout: 10000
