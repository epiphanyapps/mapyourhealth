# flow: E2E-002 Search Validation
# intent:
#   Validate city autocomplete search functionality.
#   Tests that users can search for cities and select from autocomplete.
#
# NOTE: Direct postal code entry (type + Enter) is not supported.
# Users must select from autocomplete suggestions.

appId: ${MAESTRO_APP_ID}
---

# Launch app with clean state
- launchApp:
    clearState: true

# Wait for app to load
- waitForAnimationToEnd:
    timeout: 5000

# ========================================
# Test: City Autocomplete Search (Montreal)
# ========================================
# Tests the city-level autocomplete flow - user types city name,
# selects from suggestions, and data loads for that city.

- assertVisible:
    text: "Search city or location..."
    label: "Search bar is visible"

- tapOn:
    text: "Search city or location..."
    label: "Tap on search bar"

- inputText: "Montreal"

# Wait for autocomplete suggestions
- waitForAnimationToEnd:
    timeout: 3000

# Select from autocomplete (city-level suggestion)
# Use index: 1 to skip the search field text and tap the dropdown
- tapOn:
    text: ".*Montreal.*"
    index: 1
    label: "Select Montreal from autocomplete"

- waitForAnimationToEnd:
    timeout: 5000

- extendedWaitUntil:
    visible: ".*Montreal.*"
    timeout: 10000

# Verify Montreal location is displayed
- assertVisible:
    text: ".*Montreal.*"
    label: "Montreal location is displayed"

# Montreal may or may not have data - check for either state
- runFlow:
    when:
      visible: "No data for"
    commands:
      - assertVisible:
          text: "Notify Me"
          optional: true
          label: "Notify Me button visible for location without data"
