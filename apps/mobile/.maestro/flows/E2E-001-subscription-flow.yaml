# flow: E2E-001 Subscription and Notification Flow
# intent:
#   Test the complete guest-to-subscriber journey:
#   1. Guest sees empty state with search prompt
#   2. Guest can search for cities and view data
#   3. Follow button triggers auth gate
#   4. User can navigate to signup
#
# NOTE: This flow tests up to the auth gate. Full signup requires
# email confirmation which cannot be automated in Maestro.

appId: ${MAESTRO_APP_ID}
onFlowStart:
  - runFlow: ../shared/_OnFlowStart.yaml
---

# ========================================
# Part 1: Guest Empty State
# ========================================
- assertVisible:
    text: "Find out how safe your location is"
    label: "Guest empty state title is visible"

- assertVisible:
    text: "Search above to get safety insights"
    optional: true

- assertVisible:
    text: "Search city or location..."
    label: "Search bar is visible"

# ========================================
# Part 2: Search for a City
# ========================================
- tapOn:
    text: "Search city or location..."
    label: "Tap on search bar"

- inputText: "Beverly Hills"
- pressKey: Enter

- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "Beverly Hills"
    timeout: 10000

# Verify category cards are visible
- assertVisible:
    text: "Tap Water.*"
    optional: true

# ========================================
# Part 3: Search for a Different City
# ========================================
- tapOn:
    text: "Search city or.*"
    label: "Tap on search bar"

- inputText: "New York"
- pressKey: Enter

- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "New York"
    timeout: 10000

# ========================================
# Part 4: Follow Button Triggers Auth Gate
# ========================================
- tapOn:
    text: "Follow"
    label: "Tap Follow button (should trigger auth gate)"

- assertVisible:
    text: "Welcome Back"
    label: "Login screen is visible"

- assertVisible:
    text: "Sign In"
    label: "Sign In button is visible"

# ========================================
# Part 5: Navigate to Signup
# ========================================
- tapOn:
    text: "Don't have an account\\? Sign up"
    label: "Navigate to signup screen"

- assertVisible:
    text: "Create Account"
    label: "Signup screen is visible"

- assertVisible:
    text: "Sign Up"
    label: "Sign Up button is visible"

# ========================================
# Part 6: Go Back to Dashboard
# ========================================
- tapOn:
    id: "back"
    optional: true

- tapOn:
    id: "back"
    optional: true
